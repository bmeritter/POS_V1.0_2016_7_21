<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CartItem</title>
    <script>
        function numAndSubtotal(cartItem) {
            let result = [];
            result.num = 1;
            result.subtotal = 0;
            for(let i = 0; i < cartItem.length; i++) {
                let existItem = result.find(function(item) {
                    return item.barcode === cartItem[i].barcode;
                });
                //existItem.count = 1;
                if(existItem) {
                    existItem.num++;
                    existItem.subtotal = existItem.num * existItem.price
                } else {
                    result.push(Object.assign({}, cartItem[i], {
                        num: 1,
                        subtotal:cartItem[i].price
                    }));
                }
            }
            console.log(result)
            return result;
        }


        function total(result) {
            let sum = 0;
            for(let i=0; i<result.length; i++) {

                    sum += result[i].subtotal;
            }
            return sum
        }

        function print(result, sum) {
            for(let i=0; i<result.length; i++) {
                //for(let j=0; j<cartItem.length; j++) {
                  //  if(result[i].barcode === cartItem[j].barcode) {
                        console.log("名称:" + result[i].name + ",数量:" + result[i].num + "小计:" + result[i].subtotal)
                   // }
                //}
            }

            console.log("总计：" + sum)
        }

        let cartItem = [
                {
                    barcode:"123456",
                    name:"可口可乐",
                    unit:"瓶",
                    price:3.5
                },
                {
                    barcode:"123457",
                    name:"电池",
                    unit:"个",
                    price:2
                },
                {
                    barcode:"123456",
                    name:"可口可乐",
                    unit:"瓶",
                    price:3.5
                }
        ];

     //   console.log(numAndSubtotal(cartItem))
        let result = numAndSubtotal(cartItem)
     //   console.log(total(result))
        let sum = total(result)
        print(result, sum)
    </script>
</head>

<body>

</body>
</html>