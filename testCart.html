<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>testCart</title>
    <script>
        
        function  getCount(cartItem) {
           // console.log(cartItem)
            let cartItemCount = []

            for(let i=0; i<cartItem.length; i++) {

                //在cartItemCount中查找是否存在该物品
                let exitItem = cartItemCount.find(function (item) {
                    return item.barcode === cartItem[i].barcode;
                });
                //console.log(exitItem)
                if(exitItem) {      //存在，设置count 属性 +1
                    exitItem.count++;
                }
                else {       // 不存在，将cartItem[i]对象复制给新对象，并向新对象添加count属性
                   cartItemCount.push(Object.assign({}, cartItem[i], {count: 1}));
                }

            }
            //console.log(cartItemCount)
            return cartItemCount;

        }
        
        function getSubtotal(cartItemCount) {

            for(let i=0; i<cartItemCount.length; i++) {
                cartItemCount[i].subtotal = cartItemCount[i].price * cartItemCount[i].count
            }
            console.log(cartItemCount)
            return cartItemCount;
        }
        
        function  getTotal(cartItemSbutotal) {
            let sum = 0;
            for(let i=0; i<cartItemSbutotal.length; i++) {
                sum += cartItemSbutotal[i].subtotal
            }
            return sum;
        }
        
        function print(cartItemSbutotal, sum) {
            for(let i=0; i<cartItemSbutotal.length; i++) {
                console.log("名称：" + cartItemSbutotal[i].name + ",数量：" + cartItemSbutotal[i].count +  cartItemSbutotal[i].unit + ",小计：" + cartItemSbutotal[i].subtotal)
            }
            console.log("总计：" + sum)
        }

        let cartItem = [
            {
                barcode:"ITEM000000",
                name:"可口可乐",
                unit:"瓶",
                price:3.5
            },
            {
                barcode:"ITEM000001",
                name:"电池",
                unit:"个",
                price:2
            },
            {
                barcode:"ITEM000000",
                name:"可口可乐",
                unit:"瓶",
                price:3.5
            }
        ];

        function printReceipt() {

            let cartItemCount = getCount(cartItem)
            let cartItemSbutotal = getSubtotal(cartItemCount)
            let sum = getTotal(cartItemSbutotal)
            print(cartItemSbutotal, sum)
            console.log(cartItem)
        }

        printReceipt();
        
    </script>
</head>
<body>

</body>
</html>